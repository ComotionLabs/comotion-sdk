
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel="stylesheet">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="_static/stylesheets/application-fixes.css"/>
  
  <link rel="stylesheet" href="_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="#3f51b5">
  <script src="_static/javascripts/modernizr.js"></script>
  
  
  
    <title>Getting Started with Comotion Python SDK &#8212; Comotion Python SDK Docs</title>
    <link rel="stylesheet" href="_static/material.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <link rel="shortcut icon" href="_static/favicon.png"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="comotion.dash module" href="comotion.dash.html" />
  
   

  </head>
  <body dir=ltr
        data-md-color-primary=white data-md-color-accent=light-blue>
  
  <svg class="md-svg">
    <defs data-children-count="0">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
      
    </defs>
  </svg>
  
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#index" tabindex="1" class="md-skip"> Skip to content </a>
  <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex navheader">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="#" title="Comotion Python SDK Docs"
           class="md-header-nav__button md-logo">
          
              <img src="_static/comotion_logo.png" height="26"
                   alt="comotion-sdk logo">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <span class="md-header-nav__topic">Comotion Python SDK</span>
          <span class="md-header-nav__topic"> Getting Started with Comotion Python SDK </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" action="search.html" method="get" name="search">
      <input type="text" class="md-search__input" name="q" placeholder=""Search""
             autocapitalize="off" autocomplete="off" spellcheck="false"
             data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            <a href="https://github.com/ComotionLabs/comotion-sdk/" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    comotion-sdk
  </div>
</a>
          </div>
        </div>
      
      
  
  <script src="_static/javascripts/version_dropdown.js"></script>
  <script>
    var json_loc = ""versions.json"",
        target_loc = "../",
        text = "Versions";
    $( document ).ready( add_version_dropdown(json_loc, target_loc, text));
  </script>
  

    </div>
  </nav>
</header>

  
  <div class="md-container">
    
    
    
  <nav class="md-tabs" data-md-component="tabs">
    <div class="md-tabs__inner md-grid">
      <ul class="md-tabs__list">
          <li class="md-tabs__item"><a href="#" class="md-tabs__link">comotion-sdk</a></li>
      </ul>
    </div>
  </nav>
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="#" title="Comotion Python SDK Docs" class="md-nav__button md-logo">
      
        <img src="_static/comotion_logo.png" alt=" logo" width="48" height="48">
      
    </a>
    <a href="#"
       title="Comotion Python SDK Docs">Comotion Python SDK</a>
  </label>
    <div class="md-nav__source">
      <a href="https://github.com/ComotionLabs/comotion-sdk/" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    comotion-sdk
  </div>
</a>
    </div>
  
  

</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">"Contents"</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#index--page-root" class="md-nav__link">Getting Started with Comotion Python SDK</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#installation" class="md-nav__link">Installation</a>
        </li>
        <li class="md-nav__item"><a href="#uploading-data-to-dash-data-model-v1" class="md-nav__link">Uploading Data to Dash: Data Model v1</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#uploading-a-file-to-dash" class="md-nav__link">Uploading a file to Dash</a>
        </li>
        <li class="md-nav__item"><a href="#modifying-a-file-for-upload" class="md-nav__link">Modifying a file for upload</a>
        </li>
        <li class="md-nav__item"><a href="#testing-and-debugging-an-upload-script" class="md-nav__link">Testing and debugging an upload script</a>
        </li>
        <li class="md-nav__item"><a href="#advanced-usage-with-pandas" class="md-nav__link">Advanced usage with Pandas</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#uploading-data-to-dash-data-model-v2" class="md-nav__link">Uploading Data to Dash: Data Model v2</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#read-and-upload-file-to-dash" class="md-nav__link"><code class="docutils literal notranslate"><span class="pre">read_and_upload_file_to_dash</span></code></a>
        </li>
        <li class="md-nav__item"><a href="#example-of-etl-change-for-data-model-v2" class="md-nav__link">Example of ETL change for Data Model v2</a>
        </li>
        <li class="md-nav__item"><a href="#dashbulkuploader" class="md-nav__link">DashBulkUploader</a>
        </li>
        <li class="md-nav__item"><a href="#load" class="md-nav__link">Load</a>
        </li>
        <li class="md-nav__item"><a href="#migrating-to-data-model-v2" class="md-nav__link">Migrating to Data Model v2</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#running-queries-and-extracting-data" class="md-nav__link">Running Queries and Extracting Data</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#logging-in" class="md-nav__link">Logging In</a>
        </li>
        <li class="md-nav__item"><a href="#running-a-query" class="md-nav__link">Running a query</a>
        </li>
        <li class="md-nav__item"><a href="#authentication-using-client-secret" class="md-nav__link">Authentication Using Client Secret</a>
        </li></ul>
            </nav>
        </li></ul>
            </nav>
        </li>
    
<li class="md-nav__item"><a class="md-nav__extra_link" href="_sources/index.rst.txt">Show Source</a> </li>

<li id="searchbox" class="md-nav__item"></li>

  </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
            
  
<h1 id="index--page-root">Getting Started with Comotion Python SDK<a class="headerlink" href="#index--page-root" title="Permalink to this headline">¶</a></h1>
<p>This documentation helps you get set up on and use the python Comotion SDK.  This documentation includes this getting started page, and full documentation on the sdk functions:</p>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="comotion.dash.html">comotion.dash module</a></li>
<li class="toctree-l1"><a class="reference internal" href="comotion.auth.html">comotion.auth module</a></li>
</ul>
</div>
<p>This is an open source project, and can be <a class="reference external" href="https://github.com/ComotionLabs/comotion-sdk">contributed to</a> by the community.</p>
<dl class="simple">
<dt>The full Comotion documentation portal can be found <a class="reference external" href="https://docs.comotion.us">here</a>.</dt><dd></dd>
</dl>

<h2 id="installation">Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>Install the comotion-sdk in your python environment using pip:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">comotion</span><span class="o">-</span><span class="n">sdk</span>
</pre></div>
</div>


<span id="data-model-v1-upload"></span><h2 id="uploading-data-to-dash-data-model-v1">Uploading Data to Dash: Data Model v1<a class="headerlink" href="#uploading-data-to-dash-data-model-v1" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Comotion has released a new version of our data model in 2025. We refer to the original version as Data Model v1, and the new version as Data Model v2.</p>
</div>
<p>In order to use the SDK in your python file, you must first import it.  In these examples we will import the dash module directly as follows</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">comotion</span> <span class="kn">import</span> <span class="n">dash</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">read_and_upload_file_to_dash</span></code> function can be used to upload a csv file or stream to Data Model v1.</p>

<h3 id="uploading-a-file-to-dash">Uploading a file to Dash<a class="headerlink" href="#uploading-a-file-to-dash" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">read_and_upload_file_to_dash</span></code> reads a csv file, breaks it up, gzips the files and pushes them to the Dash API.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Break up and upload file to Dash</span>

<span class="kn">from</span> <span class="nn">comotion</span> <span class="kn">import</span> <span class="n">dash</span>
<span class="kn">from</span> <span class="nn">getpass</span> <span class="kn">import</span> <span class="n">getpass</span>

<span class="c1"># set relevant parameters</span>
<span class="n">dash_orgname</span> <span class="o">=</span> <span class="s1">'my_org_name'</span>
<span class="n">dash_api_key</span> <span class="o">=</span> <span class="s1">''</span>
<span class="n">dash_api_key</span> <span class="o">=</span> <span class="n">getpass</span><span class="p">(</span>
    <span class="n">prompt</span><span class="o">=</span><span class="s1">'Enter your '</span> <span class="o">+</span> <span class="n">dash_orgname</span> <span class="o">+</span> <span class="s1">'.comodash.io api key:'</span>
<span class="p">)</span> <span class="c1"># this prompts the user to enter the api key</span>

<span class="n">dash</span><span class="o">.</span><span class="n">read_and_upload_file_to_dash</span><span class="p">(</span>
    <span class="s1">'./path/to/csv/file.csv'</span><span class="p">,</span>
    <span class="n">dash_table</span><span class="o">=</span><span class="s1">'my_table_name'</span><span class="p">,</span>
    <span class="n">dash_orgname</span><span class="o">=</span><span class="n">dash_orgname</span><span class="p">,</span>
    <span class="n">dash_api_key</span><span class="o">=</span><span class="n">dash_api_key</span>
<span class="p">)</span>
</pre></div>
</div>


<h3 id="modifying-a-file-for-upload">Modifying a file for upload<a class="headerlink" href="#modifying-a-file-for-upload" title="Permalink to this headline">¶</a></h3>
<p>Often you will want to add a column - such as an upload timestamp or batch number - to the csv file to be uploaded.  This can easily be done by using the <code class="docutils literal notranslate"><span class="pre">modify_lambda</span></code> parameter.  It accepts a python function that recieves a <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html">pandas.dataframe</a>  read from the csv. Here is an example of adding a timestamp as a column called <code class="docutils literal notranslate"><span class="pre">snapshot_timestamp</span></code> to the csv:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Break up and upload file to Dash with Extra Column</span>

<span class="kn">from</span> <span class="nn">comotion</span> <span class="kn">import</span> <span class="n">dash</span>
<span class="kn">from</span> <span class="nn">getpass</span> <span class="kn">import</span> <span class="n">getpass</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="c1"># define the function used to modify the file</span>

<span class="n">myTimeStamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">"%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S.</span><span class="si">%f</span><span class="s2">"</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">addTimeStamp</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
 <span class="n">df</span><span class="p">[</span><span class="s1">'snapshot_timestamp'</span><span class="p">]</span> <span class="o">=</span> <span class="n">myTimeStamp</span>

<span class="c1"># set relevant parameters</span>

<span class="n">dash_orgname</span> <span class="o">=</span> <span class="s1">'my_org_name'</span>
<span class="n">dash_api_key</span> <span class="o">=</span> <span class="s1">''</span>
<span class="n">dash_api_key</span> <span class="o">=</span> <span class="n">getpass</span><span class="p">(</span>
    <span class="n">prompt</span><span class="o">=</span><span class="s1">'Enter your '</span> <span class="o">+</span> <span class="n">dash_orgname</span> <span class="o">+</span> <span class="s1">'.comodash.io api key:'</span>
<span class="p">)</span> <span class="c1"># this prompts the user to enter the api key</span>

<span class="n">dash</span><span class="o">.</span><span class="n">read_and_upload_file_to_dash</span><span class="p">(</span>
    <span class="s1">'./path/to/csv/file.csv'</span><span class="p">,</span>
    <span class="n">dash_table</span><span class="o">=</span><span class="s1">'my_table_name'</span><span class="p">,</span>
    <span class="n">dash_orgname</span><span class="o">=</span><span class="n">dash_orgname</span><span class="p">,</span>
    <span class="n">dash_api_key</span><span class="o">=</span><span class="n">dash_api_key</span><span class="p">,</span>
    <span class="n">modify_lambda</span><span class="o">=</span><span class="n">addTimeStamp</span>
<span class="p">)</span>
</pre></div>
</div>


<h3 id="testing-and-debugging-an-upload-script">Testing and debugging an upload script<a class="headerlink" href="#testing-and-debugging-an-upload-script" title="Permalink to this headline">¶</a></h3>
<p>In order to check that your script is working, you can run a dry run. This saves the files locally rather than uploading them to dash - so that you can check the result before uploading.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># First test the upload using the dry_run feature</span>

<span class="kn">from</span> <span class="nn">comotion</span> <span class="kn">import</span> <span class="n">dash</span>
<span class="kn">from</span> <span class="nn">getpass</span> <span class="kn">import</span> <span class="n">getpass</span>

<span class="c1"># set relevant parameters</span>
<span class="n">dash_orgname</span> <span class="o">=</span> <span class="s1">'my_org_name'</span>
<span class="n">dash_api_key</span> <span class="o">=</span> <span class="s1">''</span>
<span class="n">dash_api_key</span> <span class="o">=</span> <span class="n">getpass</span><span class="p">(</span>
    <span class="n">prompt</span><span class="o">=</span><span class="s1">'Enter your '</span> <span class="o">+</span> <span class="n">dash_orgname</span> <span class="o">+</span> <span class="s1">'.comodash.io api key:'</span>
<span class="p">)</span> <span class="c1"># this prompts the user to enter the api key</span>

<span class="n">dash</span><span class="o">.</span><span class="n">read_and_upload_file_to_dash</span><span class="p">(</span>
    <span class="s1">'./path/to/csv/file.csv'</span><span class="p">,</span>
    <span class="n">dash_table</span><span class="o">=</span><span class="s1">'my_table_name'</span><span class="p">,</span>
    <span class="n">dash_orgname</span><span class="o">=</span><span class="n">dash_orgname</span><span class="p">,</span>
    <span class="n">dash_api_key</span><span class="o">=</span><span class="n">dash_api_key</span><span class="p">,</span>
    <span class="n">path_to_output_for_dryrun</span><span class="o">=</span><span class="s1">'./outputpath/'</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Instead of uploading, this will output the files that would have been uploaded to <code class="docutils literal notranslate"><span class="pre">./outputpath/</span></code>. If the file to be uplaoded is large, it will break it up and all files would be placed in the output path.</p>


<h3 id="advanced-usage-with-pandas">Advanced usage with Pandas<a class="headerlink" href="#advanced-usage-with-pandas" title="Permalink to this headline">¶</a></h3>
<p>Using this sdk in conjunction with <a class="reference external" href="https://pandas.pydata.org">pandas</a> provides a powerful toolset to integrate with any source.</p>
<p>Here is an example of reading a table named <code class="docutils literal notranslate"><span class="pre">my_table</span></code> from a postgres database:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># upload a postgres table to dash using Pandas</span>

<span class="kn">from</span> <span class="nn">comotion</span> <span class="kn">import</span> <span class="n">dash</span>
<span class="kn">from</span> <span class="nn">getpass</span> <span class="kn">import</span> <span class="n">getpass</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># set relevant parameters</span>

<span class="n">dash_orgname</span> <span class="o">=</span> <span class="s1">'my_org_name'</span>
<span class="n">dash_api_key</span> <span class="o">=</span> <span class="s1">''</span>
<span class="n">dash_api_key</span> <span class="o">=</span> <span class="n">getpass</span><span class="p">(</span>
    <span class="n">prompt</span><span class="o">=</span><span class="s1">'Enter your '</span> <span class="o">+</span> <span class="n">dash_orgname</span> <span class="o">+</span> <span class="s1">'.comodash.io api key:'</span>
<span class="p">)</span> <span class="c1"># this prompts the user to enter the api key</span>


<span class="c1"># set timestamp to use as a snapshot indication</span>
<span class="n">myTimeStamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">"%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S.</span><span class="si">%f</span><span class="s2">"</span><span class="p">)</span>

<span class="c1"># create dataframe from source db:</span>
<span class="n">df_iterable</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_sql_table</span><span class="p">(</span>
   <span class="n">table_name</span><span class="o">=</span><span class="s1">'my_table'</span><span class="p">,</span>
   <span class="s1">'postgresql://username:password@address.of.db:5432/mydatabase'</span><span class="p">,</span>
   <span class="n">chunksize</span><span class="o">=</span><span class="mi">30000</span>
   <span class="p">)</span>

<span class="c1"># note the use of chunksize which will ensure the whole table is not read at once.</span>
<span class="c1"># this is also important to ensure that files uploaded to Dash are below the size limit</span>


<span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">df_iterable</span><span class="p">:</span>
   <span class="c1"># add timestamp as a column</span>
   <span class="n">df</span><span class="p">[</span><span class="s1">'snapshot_timestamp'</span><span class="p">]</span> <span class="o">=</span> <span class="n">myTimeStamp</span>

   <span class="c1"># create a gzipped csv stream from the dataframe</span>
   <span class="n">csv_stream</span> <span class="o">=</span> <span class="n">dash</span><span class="o">.</span><span class="n">create_gzipped_csv_stream_from_df</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

   <span class="c1"># upload the stream to dash</span>
   <span class="n">dash_response</span> <span class="o">=</span> <span class="n">dash</span><span class="o">.</span><span class="n">upload_csv_to_dash</span><span class="p">(</span>
       <span class="n">dash_orgname</span><span class="p">,</span>
       <span class="n">dash_api_key</span><span class="p">,</span>
       <span class="s1">'my_table_in_dash'</span><span class="p">,</span>
       <span class="n">csv_stream</span>
   <span class="p">)</span>
</pre></div>
</div>



<h2 id="uploading-data-to-dash-data-model-v2">Uploading Data to Dash: Data Model v2<a class="headerlink" href="#uploading-data-to-dash-data-model-v2" title="Permalink to this headline">¶</a></h2>
<p>The following upload toolsets are available after <a class="reference internal" href="#migrate-to-v2"><span class="std std-ref">Migrating to Data Model v2</span></a>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">read_and_upload_file_to_dash</span></code>: <a class="reference internal" href="#data-model-v1-upload"><span class="std std-ref">Uploading Data to Dash: Data Model v1</span></a></p></li>
<li><p><a class="reference internal" href="#dashbulkuploader"><span class="std std-ref">DashBulkUploader</span></a></p></li>
<li><p><a class="reference internal" href="#load"><span class="std std-ref">Load</span></a></p></li>
</ul>

<h3 id="read-and-upload-file-to-dash"><code class="docutils literal notranslate"><span class="pre">read_and_upload_file_to_dash</span></code><a class="headerlink" href="#read-and-upload-file-to-dash" title="Permalink to this headline">¶</a></h3>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Comotion will deprecate the <code class="docutils literal notranslate"><span class="pre">read_and_upload_file_to_dash</span></code> function on 1 December 2025, along with Data Model v1.</p>
<p>Once you are operating in the new lake, we recommend you move to using the new <a class="reference internal" href="#load"><span class="std std-ref">Load</span></a> and <a class="reference internal" href="#dashbulkuploader"><span class="std std-ref">DashBulkUploader</span></a> class for uploads.  Reach out to us for assistance at <a class="reference external" href="mailto:dash%40comotion.co.za">dash<span>@</span>comotion<span>.</span>co<span>.</span>za</a> .</p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">read_and_upload_file_to_dash</span></code> function can also be used to upload to Data Model v2.  See the above section on using this function:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#data-model-v1-upload"><span class="std std-ref">Uploading Data to Dash: Data Model v1</span></a>.</p></li>
</ul>
<p>The key considerations when uploading to the v2 data model with this function are as follows:</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">file</span></code> parameter can now accept a path to a csv, excel, json, parquet or directory, a <code class="docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code> or a <code class="docutils literal notranslate"><span class="pre">dash.Query</span></code> object.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">dash_api_key</span></code> is no longer required.  Instead you will have to run the following in your command line to authenticate: <code class="docutils literal notranslate"><span class="pre">comotion</span> <span class="pre">authenticate</span></code></p></li>
<li><p>You will need to specify <code class="docutils literal notranslate"><span class="pre">data_model_version</span> <span class="pre">=</span> <span class="pre">'v2'</span></code> if you have not run a full migration (more on migrating below)</p></li>
<li><p>The function will return a <code class="docutils literal notranslate"><span class="pre">DashBulkUploader</span></code> object.</p></li>
</ul>


<h3 id="example-of-etl-change-for-data-model-v2">Example of ETL change for Data Model v2<a class="headerlink" href="#example-of-etl-change-for-data-model-v2" title="Permalink to this headline">¶</a></h3>
<p><strong>Python for v1 Upload</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">comotion.dash</span> <span class="kn">import</span> <span class="n">read_and_upload_file_to_dash</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="c1"># In this example, we use the modify_lambda argument to add a column to the end of the lake table to mark the timestamp when the upload was started</span>
<span class="k">def</span> <span class="nf">add_upload_timestamp</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
   <span class="n">upload_timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
   <span class="n">df</span><span class="p">[</span><span class="s1">'upload_timestamp'</span><span class="p">]</span> <span class="o">=</span> <span class="n">upload_timestamp</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">'%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S'</span><span class="p">)</span>

<span class="n">upload_response</span> <span class="o">=</span> <span class="n">read_and_upload_file_to_dash</span><span class="p">(</span>
   <span class="n">file</span> <span class="o">=</span> <span class="s1">'path/to/file.csv'</span><span class="p">,</span>
   <span class="n">dash_table</span> <span class="o">=</span> <span class="s1">'my_lake_table_name'</span><span class="p">,</span>
   <span class="n">dash_orgname</span> <span class="o">=</span> <span class="s1">'my_dash_orgname'</span><span class="p">,</span>
   <span class="n">dash_api_key</span> <span class="o">=</span> <span class="s1">'my_api_key'</span><span class="p">,</span>
   <span class="n">modify_lambda</span> <span class="o">=</span> <span class="n">add_upload_timestamp</span> <span class="c1"># Function defined above</span>
<span class="p">)</span>
</pre></div>
</div>
<p><strong>Python for v2 Upload</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">comotion.dash</span> <span class="kn">import</span> <span class="n">read_and_upload_file_to_dash</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="c1"># In this example, we use the modify_lambda argument to add a column to the end of the lake table to mark the timestamp when the upload was started</span>
<span class="k">def</span> <span class="nf">add_upload_timestamp</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
   <span class="n">upload_timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
   <span class="n">df</span><span class="p">[</span><span class="s1">'upload_timestamp'</span><span class="p">]</span> <span class="o">=</span> <span class="n">upload_timestamp</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">'%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S'</span><span class="p">)</span>
   <span class="n">df</span><span class="p">[</span><span class="s1">'data_import_batch'</span><span class="p">]</span> <span class="o">=</span> <span class="n">upload_timestamp</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">'%Y-%m-</span><span class="si">%d</span><span class="s1">'</span><span class="p">)</span> <span class="c1"># First change: Add the data import batch column.</span>

<span class="n">upload_response</span> <span class="o">=</span> <span class="n">read_and_upload_file_to_dash</span><span class="p">(</span>
   <span class="n">file</span> <span class="o">=</span> <span class="s1">'path/to/file.csv'</span><span class="p">,</span>
   <span class="n">dash_table</span> <span class="o">=</span> <span class="s1">'my_lake_table_name'</span><span class="p">,</span>
   <span class="n">dash_orgname</span> <span class="o">=</span> <span class="s1">'my_dash_orgname'</span><span class="p">,</span>
   <span class="c1"># API key is no longer required for the upload</span>
   <span class="n">modify_lambda</span> <span class="o">=</span> <span class="n">add_upload_timestamp</span><span class="p">,</span> <span class="c1"># Function defined above</span>
   <span class="n">data_model_version</span> <span class="o">=</span> <span class="s1">'v2'</span> <span class="c1"># Add this parameter to force an attempted upload to the new lake</span>
<span class="p">)</span>
</pre></div>
</div>


<span id="id1"></span><h3 id="dashbulkuploader">DashBulkUploader<a class="headerlink" href="#dashbulkuploader" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">DashBulkUploader</span></code> class is the recommended way to upload data to Dash. If more control is needed over the upload process, the <a class="reference internal" href="#load"><span class="std std-ref">Load</span></a> class can be used instead.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">comotion.dash</span> <span class="kn">import</span> <span class="n">DashBulkUploader</span>
<span class="kn">from</span> <span class="nn">comotion.auth</span> <span class="kn">import</span> <span class="n">Auth</span>

<span class="n">auth_token</span> <span class="o">=</span> <span class="n">Auth</span><span class="p">(</span><span class="n">orgname</span> <span class="o">=</span> <span class="s1">'my_org_name'</span><span class="p">)</span>
<span class="n">my_lake_table</span> <span class="o">=</span> <span class="s1">'v1_policies'</span>
<span class="n">uploader</span> <span class="o">=</span> <span class="n">DashBulkUploader</span><span class="p">(</span><span class="n">auth_token</span> <span class="o">=</span> <span class="n">auth_token</span><span class="p">)</span>
</pre></div>
</div>
<p>You can now add a load to the uploader.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">uploader</span><span class="o">.</span><span class="n">add_load</span><span class="p">(</span>
                  <span class="n">table_name</span> <span class="o">=</span> <span class="n">my_lake_table</span><span class="p">,</span>
                  <span class="n">check_sum</span> <span class="o">=</span> <span class="p">{</span>
                     <span class="c1"># SQL aggregation: expected result</span>
                     <span class="s1">'sum(salary)'</span><span class="p">:</span> <span class="mi">12345</span>
                  <span class="p">},</span> <span class="c1"># Alternatively, provide the track_rows_uploaded arg as true</span>
                  <span class="n">load_as_service_client_id</span> <span class="o">=</span> <span class="s1">'0'</span>
                <span class="p">)</span>
</pre></div>
</div>
<p>This creates a Load and adds it to the <code class="docutils literal notranslate"><span class="pre">uploader.uploads</span></code> object.  Note that <code class="docutils literal notranslate"><span class="pre">modify_lambda</span></code>, <code class="docutils literal notranslate"><span class="pre">path_to_output_for_dryrun</span></code> and <code class="docutils literal notranslate"><span class="pre">chunksize</span></code> can also be specified and will behave the same as for the <code class="docutils literal notranslate"><span class="pre">read_and_upload_file_to_dash</span></code> function.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">check_sum</span></code> parameter can be used to verify a load before it is pushed to the lake.  Specify a dictionary of valid check sums as in the example above to ensure data quality and completeness. Any valid SQL aggregation can be provided in the keys, and a scalar value should be provided for the values.  You will need to calculate these check sums at source and then provide the expected result as the value.</p>
<p>If this is not required, you can set <code class="docutils literal notranslate"><span class="pre">track_rows_uploaded</span> <span class="pre">=</span> <span class="pre">True</span></code>, which will automatically create the check_sum <code class="docutils literal notranslate"><span class="pre">{'count(*)':</span> <span class="pre">x}</span></code>, where <code class="docutils literal notranslate"><span class="pre">x</span></code> is the number of rows in the source data.</p>
<p>Now we need to add a data source to the load</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">uploader</span><span class="o">.</span><span class="n">add_data_to_load</span><span class="p">(</span>
                           <span class="n">table_name</span> <span class="o">=</span> <span class="n">my_lake_table</span><span class="p">,</span>
                           <span class="n">data</span> <span class="o">=</span> <span class="s1">'data/inforce_policies'</span><span class="p">,</span> <span class="c1"># Can be a path to a csv, parquet or directory, a pandas dataframe or a dash.Query object</span>
                           <span class="n">dtype</span><span class="o">=</span><span class="p">{</span><span class="s1">'id'</span><span class="p">:</span> <span class="s1">'int32'</span><span class="p">,</span> <span class="s1">'name'</span><span class="p">:</span> <span class="s1">'string'</span><span class="p">,</span> <span class="s1">'age'</span><span class="p">:</span> <span class="s1">'int32'</span><span class="p">,</span> <span class="s1">'salary'</span><span class="p">:</span> <span class="s1">'float64'</span><span class="p">}</span> <span class="c1"># The dtype parameter is recommended (but optional), as it allows control of lake schema from source and improves upload data quality.</span>
                         <span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">uploader</span><span class="o">.</span><span class="n">uploads</span><span class="p">)</span> <span class="c1"># Will print the dictionary containing loads and data sources added to the uploader.</span>
</pre></div>
</div>
<p>This function will add the datasource to the applicable load.  You can add multiple data sources to 1 load.  We recommend using the <code class="docutils literal notranslate"><span class="pre">dtype</span></code> parameter, which should be compatible with the pandas <code class="docutils literal notranslate"><span class="pre">dtype</span></code> argument.</p>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>If a path to a directory is specified, all valid files in the directory will be uploaded to the lake table specified.</p>
<p>This allows you to chunk files and store them in the same folder for more efficient extract and upload.</p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">file_key</span></code> parameter is used to avoid duplicating a data source within a load.  This is automatically generated if not provided.</p>
<p>You can also use the <code class="docutils literal notranslate"><span class="pre">uploader.remove_load()</span></code> or <code class="docutils literal notranslate"><span class="pre">uploader.remove_data_from_load()</span></code> functions to remove loads or data sources from the uploader respectively.</p>
<div class="admonition-obtaining-the-file-key-to-remove-data-from-a-load admonition">
<p class="admonition-title">Obtaining the <code class="docutils literal notranslate"><span class="pre">file_key</span></code> to remove data from a load</p>
<p>The <code class="docutils literal notranslate"><span class="pre">remove_data_from_load</span></code> function requires a file key to be specified, which you can get from the <code class="docutils literal notranslate"><span class="pre">uploader.uploads</span></code> object.</p>
</div>
<p>Finally, we can execute the upload.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">uploader</span><span class="o">.</span><span class="n">execute_upload</span><span class="p">(</span><span class="n">table_name</span> <span class="o">=</span> <span class="n">my_lake_table</span><span class="p">)</span> <span class="c1"># Also see functions execute_multiple_uploads and execute_all_uploads.</span>
</pre></div>
</div>
<p>This will execute the upload.</p>
<p>You can also check on the load statuses at any time.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">uploader</span><span class="o">.</span><span class="n">get_load_info</span><span class="p">()</span>
</pre></div>
</div>


<span id="id2"></span><h3 id="load">Load<a class="headerlink" href="#load" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">Load</span></code> class is the most flexible for uploading data to Dash.  The process can be outlined as follows:</p>
<ol class="arabic simple">
<li><p>Create a <code class="docutils literal notranslate"><span class="pre">Load</span></code> object</p></li>
<li><p>Upload data sources to the load</p></li>
<li><p>Commit the load with a valid check sum</p></li>
</ol>
<p>Creating the <code class="docutils literal notranslate"><span class="pre">Load</span></code> object is simple.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">comotion.dash</span> <span class="kn">import</span> <span class="n">Load</span><span class="p">,</span> <span class="n">Dashconfig</span>
<span class="kn">from</span> <span class="nn">comotion.auth</span> <span class="kn">import</span> <span class="n">Auth</span>

<span class="n">dashconfig</span> <span class="o">=</span> <span class="n">DashConfig</span><span class="p">(</span><span class="n">Auth</span><span class="p">(</span><span class="n">orgname</span> <span class="o">=</span> <span class="s1">'my_org_name'</span><span class="p">))</span>
<span class="n">load</span> <span class="o">=</span> <span class="n">Load</span><span class="p">(</span><span class="n">config</span> <span class="o">=</span> <span class="n">DashConfig</span><span class="p">,</span>
            <span class="n">load_type</span> <span class="o">=</span> <span class="s1">'APPEND_ONLY'</span><span class="p">,</span>
            <span class="n">table_name</span> <span class="o">=</span> <span class="s1">'v1_inforce_policies'</span><span class="p">,</span>
            <span class="n">load_as_service_client_id</span> <span class="o">=</span> <span class="s1">'0'</span><span class="p">,</span>
            <span class="n">track_rows_uploaded</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="c1"># Note modify_lambda, chunksize and path_to_output_for_dryrun are also options</span>
            <span class="p">)</span>
</pre></div>
</div>
<p>This creates a <code class="docutils literal notranslate"><span class="pre">Load</span></code> object.  The <code class="docutils literal notranslate"><span class="pre">load_type</span></code> currently only supports <code class="docutils literal notranslate"><span class="pre">APPEND_ONLY</span></code>, which means the data sources is added to the existing data in the lake table.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">load_as_service_client_id</span></code> parameter is not required if the <code class="docutils literal notranslate"><span class="pre">service_client_id</span></code> column exists in the data already. You will receive a warning when this is not specified, but it can be ignored if the <code class="docutils literal notranslate"><span class="pre">service_client_id</span></code> column exists in the data source.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">modify_lambda</span></code>, <code class="docutils literal notranslate"><span class="pre">path_to_output_for_dryrun</span></code> and <code class="docutils literal notranslate"><span class="pre">chunksize</span></code> arguments are also available.</p>
<p>You can also re-create an existing load if you have the correct <code class="docutils literal notranslate"><span class="pre">load_id</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">load</span> <span class="o">=</span> <span class="n">Load</span><span class="p">(</span><span class="n">config</span> <span class="o">=</span> <span class="n">DashConfig</span><span class="p">,</span>
            <span class="n">load_id</span> <span class="o">=</span> <span class="s1">'load_id'</span>
            <span class="p">)</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Do not specify <code class="docutils literal notranslate"><span class="pre">load_type</span></code>, <code class="docutils literal notranslate"><span class="pre">table_name</span></code>, <code class="docutils literal notranslate"><span class="pre">load_as_service_client_id</span></code> or <code class="docutils literal notranslate"><span class="pre">partitions</span></code> if the <code class="docutils literal notranslate"><span class="pre">load_id</span></code> is provided. The Load object will not be created.</p>
</div>
<p>Now we can add data sources to the load.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Several examples shown for demonstration, but typically only one of these functions will be required.</span>

<span class="n">dtype</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'id'</span><span class="p">:</span> <span class="s1">'int32'</span><span class="p">,</span> <span class="s1">'name'</span><span class="p">:</span> <span class="s1">'string'</span><span class="p">,</span> <span class="s1">'age'</span><span class="p">:</span> <span class="s1">'int32'</span><span class="p">,</span> <span class="s1">'salary'</span><span class="p">:</span> <span class="s1">'float64'</span><span class="p">}</span>
<span class="n">load</span><span class="o">.</span><span class="n">upload_df</span><span class="p">(</span> <span class="c1"># Uploads a pandas dataframe</span>
   <span class="n">df</span> <span class="o">=</span> <span class="n">df_for_upload</span>
<span class="p">)</span>

<span class="n">load</span><span class="o">.</span><span class="n">upload_file</span><span class="p">(</span><span class="c1"># Uploads a csv, parquet, json or excel file or file .io stream. Note a file directory will not work here in the same was as for the DashBulkUploader.</span>
   <span class="n">data</span> <span class="o">=</span> <span class="n">path_to_upload_file</span><span class="p">,</span>
   <span class="n">dtype</span> <span class="o">=</span> <span class="n">dtype</span> <span class="c1"># Recommended usage</span>
<span class="p">)</span>

<span class="n">load</span><span class="o">.</span><span class="n">upload_dash_query</span><span class="p">(</span><span class="c1"># Uploads the result of a dash.Query object.</span>
   <span class="n">data</span> <span class="o">=</span> <span class="n">dash_query_object</span><span class="p">,</span>
   <span class="n">dtype</span> <span class="o">=</span> <span class="n">dtype</span> <span class="c1"># Recommended usage</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Note that a file key can be specified, but a valid file key will be generated if not provided.</p>
<p>Uploads are always converted to a <code class="docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code> before uploading the data.  This allows you to provide valid pandas arguments in the <code class="docutils literal notranslate"><span class="pre">upload_file</span></code> and <code class="docutils literal notranslate"><span class="pre">upload_dash_query</span></code> functions as well, e.g. for an excel spreadsheet:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">load</span><span class="o">.</span><span class="n">upload_file</span><span class="p">(</span>
   <span class="n">data</span> <span class="o">=</span> <span class="n">path_to_upload_file</span><span class="p">,</span>
   <span class="n">sheet_name</span> <span class="o">=</span> <span class="s1">'inforce_book'</span><span class="p">,</span>
   <span class="n">skiprows</span> <span class="o">=</span> <span class="mi">2</span>
   <span class="c1"># Add any more valid pandas arguments here</span>
<span class="p">)</span>
</pre></div>
</div>
<p>The following pandas arguments should not be provided: <code class="docutils literal notranslate"><span class="pre">['filepath_or_buffer',</span> <span class="pre">'chunksize',</span> <span class="pre">'nrows',</span> <span class="pre">'path',</span> <span class="pre">'path_or_buf',</span> <span class="pre">'io']</span></code></p>
<p>Once all your data sources are added, you can commit the load.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">load</span><span class="o">.</span><span class="n">commit</span><span class="p">(</span>
   <span class="n">check_sum</span> <span class="o">=</span> <span class="p">{</span>
      <span class="s1">'sum(salary)'</span><span class="p">:</span> <span class="mi">12345</span>
   <span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">check_sum</span></code> parameter is used to verify a load before it is pushed to the lake.  Specify a dictionary of valid check sums as in the example above to ensure data quality and completeness. Any valid SQL aggregation can be provided in the keys, and a scalar value should be provided for the values.  You will need to calculate these check sums at source and then provide the expected result as the value.</p>
<p>Note that in this example, a check sum is not necessarily required because we specified <code class="docutils literal notranslate"><span class="pre">track_rows_uploaded</span> <span class="pre">=</span> <span class="pre">True</span></code> when creating the load.  If the load had been created with <code class="docutils literal notranslate"><span class="pre">track_rows_uploaded</span> <span class="pre">=</span> <span class="pre">False</span></code>, a check sum is required on commit.</p>
<p>You can check the status of your load at any time.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">load_info</span> <span class="o">=</span> <span class="n">load</span><span class="o">.</span><span class="n">get_load_info</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">load_info</span><span class="p">)</span>
</pre></div>
</div>


<span id="migrate-to-v2"></span><h3 id="migrating-to-data-model-v2">Migrating to Data Model v2<a class="headerlink" href="#migrating-to-data-model-v2" title="Permalink to this headline">¶</a></h3>
<p>You can migrate to data model v2 with the SDK.  First you will need to run a flash schema migration.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">comotion.dash</span> <span class="kn">import</span> <span class="n">DashConfig</span><span class="p">,</span> <span class="n">Migration</span>
<span class="kn">from</span> <span class="nn">comotion.auth</span> <span class="kn">import</span> <span class="n">Auth</span>

<span class="n">config</span> <span class="o">=</span> <span class="n">DashConfig</span><span class="p">(</span><span class="n">Auth</span><span class="p">(</span><span class="s2">"myorgname"</span><span class="p">))</span>

<span class="n">migration</span> <span class="o">=</span> <span class="n">Migration</span><span class="p">(</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span><span class="p">)</span>
<span class="n">migration</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">migration_type</span> <span class="o">=</span> <span class="s1">'FLASH_SCHEMA'</span><span class="p">)</span> <span class="c1"># This is the default value so it does not need to be specified</span>
</pre></div>
</div>
<p>This copies the schema of all your lake tables from the v1 lake to the v2 lake.</p>
<p>Now you will be able to test your ETL on the new lake, using the <code class="docutils literal notranslate"><span class="pre">read_and_upload_file_to_dash</span></code> function, <code class="docutils literal notranslate"><span class="pre">DashBulkUploader</span></code> class or <code class="docutils literal notranslate"><span class="pre">Load</span></code> class.</p>
<p>Once you are happy that your ETL will work with the new lake, you can run a full migration.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">migration</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">migration_type</span> <span class="o">=</span> <span class="s1">'FULL_MIGRATION'</span><span class="p">,</span>
                <span class="n">clear_out_new_lake</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>This clears out the v2 lake and runs the full migration of data.  If <code class="docutils literal notranslate"><span class="pre">clear_out_new_lake</span></code> is false and there is data in the v2 lake, the full migration will fail.</p>
<p>Good practice when migrating would be:</p>
<ol class="arabic simple">
<li><p>Run the flash schema migration</p></li>
<li><p>Test your ETL on the new lake until satisfied.</p></li>
<li><p>Stop ETL processes to the old lake.</p></li>
<li><p>Run the full migration (the length of time for this depends on the amount of data in your lake, but it should not take more than a couple of hours).</p></li>
<li><p>Deploy your new ETL processes.</p></li>
</ol>
<p>Once the full migration is run, you can no longer upload to the v1 lake.</p>
<p>Check on the migration status at any time.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">migration</span><span class="o">.</span><span class="n">status</span><span class="p">())</span>
</pre></div>
</div>



<h2 id="running-queries-and-extracting-data">Running Queries and Extracting Data<a class="headerlink" href="#running-queries-and-extracting-data" title="Permalink to this headline">¶</a></h2>
<p>You can use the sdk to run queries on Dash, as well as download the results in csv format.</p>

<h3 id="logging-in">Logging In<a class="headerlink" href="#logging-in" title="Permalink to this headline">¶</a></h3>
<p>The query API is built on v2 of the Comotion API - which uses a new way to authenticate.  You do not need an API key, but can log in with your normal user name and password.</p>
<p>In order to do this, after you have installed the SDK, you need to authenticate from the command line.  Type in the following from the command line</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">comotion</span> <span class="n">authenticate</span>
</pre></div>
</div>
<p>You will be prompted for your <code class="docutils literal notranslate"><span class="pre">orgname</span></code> which is your orgnisation’s unique name, and then a browser will open for you to login.</p>
<p>Once this process is complete, the relevant keys will automatically be saved in your computers’s credentials manager.</p>
<p>To prevent asking for orgname every time, you can save your orgname as an environment variable <code class="docutils literal notranslate"><span class="pre">COMOTION_ORGNAME</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">export</span> <span class="n">COMOTION_ORGNAME</span><span class="o">=</span><span class="n">orgname</span>
<span class="o">&gt;</span> <span class="n">comotion</span> <span class="n">authenticate</span>
</pre></div>
</div>
<p>or, include it directly in the comment line:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">comotion</span> <span class="o">-</span><span class="n">o</span> <span class="n">orgname</span> <span class="n">authenticate</span>
</pre></div>
</div>


<h3 id="running-a-query">Running a query<a class="headerlink" href="#running-a-query" title="Permalink to this headline">¶</a></h3>
<p>You can then use the query object in the <a class="reference internal" href="comotion.dash.html"><span class="doc">comotion.dash module</span></a> to create  a query and download the results.  Here is an example code snippet.  You do not need to authenticate in your code - the Auth class takes care of that.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">comotion.dash</span> <span class="kn">import</span> <span class="n">DashConfig</span>
<span class="kn">from</span> <span class="nn">comotion.auth</span> <span class="kn">import</span> <span class="n">Auth</span>
<span class="kn">from</span> <span class="nn">comotion.dash</span> <span class="kn">import</span> <span class="n">Query</span>

<span class="n">config</span> <span class="o">=</span> <span class="n">DashConfig</span><span class="p">(</span><span class="n">Auth</span><span class="p">(</span><span class="s2">"myorgname"</span><span class="p">))</span>

<span class="c1"># this step creates the query object and kicks off the query</span>
<span class="n">query</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span><span class="n">query_text</span><span class="o">=</span><span class="s2">"select 1"</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">)</span>

<span class="c1"># this step blocks until the query is complete and provides the query metadata</span>
<span class="n">final_query_info</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">wait_to_complete</span><span class="p">()</span>


<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"myfile.csv"</span><span class="p">,</span> <span class="s2">"wb"</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
   <span class="k">with</span> <span class="n">query</span><span class="o">.</span><span class="n">get_csv_for_streaming</span><span class="p">()</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">stream</span><span class="p">(</span><span class="mi">524288</span><span class="p">):</span>
         <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
</pre></div>
</div>


<h3 id="authentication-using-client-secret">Authentication Using Client Secret<a class="headerlink" href="#authentication-using-client-secret" title="Permalink to this headline">¶</a></h3>
<p>We have introduced an additional method of authenticating to the Comotion API using a client secret.  This allows applications to consume the API without a user.</p>
<div class="admonition-user-vs-application-authentication admonition">
<p class="admonition-title">User vs Application Authentication</p>
<p>If your users are logging into an application which needs to consume data from Dash, a better approach is to integrate that app with our single signon functionality.</p>
<p>That application can then use an access token generated for that user to consume the dash API.  This means better security as Dash will be aware of the user, and obey things like Service Client data siloing.</p>
<p>This section deals with the scenario where the application itself is acting as the user, which is useful for various data extraction and loading scenarios.</p>
</div>
<p>In order to use this functionality, the dash team will need to create a new <code class="docutils literal notranslate"><span class="pre">client</span></code>, and supply a client_id and secret key that will be used to authenticate.  Get in touch with <a class="reference external" href="mailto:dash%40comotion.co.za">dash<span>@</span>comotion<span>.</span>co<span>.</span>za</a>.</p>
<p>Once that is done, your application can authenticate using the secret key using the <code class="docutils literal notranslate"><span class="pre">application_secret_id</span></code> and <code class="docutils literal notranslate"><span class="pre">application_client_secret</span></code> parameters, as shown in the example below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">comotion.dash</span> <span class="kn">import</span> <span class="n">DashConfig</span>
<span class="kn">from</span> <span class="nn">comotion.auth</span> <span class="kn">import</span> <span class="n">Auth</span>
<span class="kn">from</span> <span class="nn">comotion.dash</span> <span class="kn">import</span> <span class="n">Query</span>

<span class="c1">## Authenticate as an application</span>
<span class="n">auth</span> <span class="o">=</span> <span class="n">Auth</span><span class="p">(</span>
     <span class="n">entity_type</span><span class="o">=</span><span class="n">Auth</span><span class="o">.</span><span class="n">APPLICATION</span><span class="p">,</span>
     <span class="n">application_client_id</span><span class="o">=</span><span class="s2">"test"</span><span class="p">,</span>
     <span class="n">application_client_secret</span><span class="o">=</span><span class="s2">"2shjkdfbjsdhfg2893847"</span><span class="p">,</span>
     <span class="c1">#best to pass to your application from an apprioriate secrets manager or environment variable</span>
     <span class="n">orgname</span><span class="o">=</span><span class="s2">"myorgname"</span>
<span class="p">)</span>
<span class="n">config</span> <span class="o">=</span> <span class="n">DashConfig</span><span class="p">(</span><span class="n">auth</span><span class="p">)</span>

<span class="c1"># this step creates the query object and kicks off the query</span>
<span class="n">query</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span><span class="n">query_text</span><span class="o">=</span><span class="s2">"select 1"</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">)</span>

<span class="c1"># this step blocks until the query is complete and provides the query metadata</span>
<span class="n">final_query_info</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">wait_to_complete</span><span class="p">()</span>

<span class="k">if</span> <span class="n">final_query_info</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s1">'FAILED'</span><span class="p">:</span>
   <span class="c1"># deal with failure scenario</span>
   <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Error while retrieving Dash data: Query failed; </span><span class="si">{final_query_info.status.state_change_reason}</span><span class="s1">'</span><span class="p">)</span>

<span class="k">elif</span> <span class="n">final_query_info</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s1">'CANCELLED'</span><span class="p">:</span>
   <span class="c1"># deal with cancelled scenario</span>
   <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Error while retrieving Dash data: Query cancelled; </span><span class="si">{final_query_info.status.state_change_reason}</span><span class="s1">'</span><span class="p">)</span>

<span class="k">else</span><span class="p">:</span>
   <span class="c1"># deal with success scenario</span>
   <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"myfile.csv"</span><span class="p">,</span> <span class="s2">"wb"</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
      <span class="k">with</span> <span class="n">query</span><span class="o">.</span><span class="n">get_csv_for_streaming</span><span class="p">()</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
         <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">stream</span><span class="p">(</span><span class="mi">524288</span><span class="p">):</span>
            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
</pre></div>
</div>
<p>To process the output data further instead of writing to a csv file, load the data into a dataframe:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">response</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">get_csv_for_streaming</span><span class="p">()</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">'utf-8'</span><span class="p">))</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="c1"># further processing...</span>
</pre></div>
</div>





          </article>
        </div>
      </div>
    </main>
  </div>
  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
          
            <a href="comotion.dash.html" title="comotion.dash module"
               class="md-flex md-footer-nav__link md-footer-nav__link--next"
               rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span
                class="md-flex__ellipsis"> <span
                class="md-footer-nav__direction"> "Next" </span> comotion.dash module </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink"><i
                class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
          <div class="md-footer-copyright__highlight">
              &#169; Copyright 2021, Comotion Business Solutions.
              
          </div>
            Created using
            <a href="http://www.sphinx-doc.org/">Sphinx</a> 2.4.4.
             and
            <a href="https://github.com/bashtage/sphinx-material/">Material for
              Sphinx</a>
        </div>
      </div>
    </div>
  </footer>
  <script src="_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>
  </body>
</html>